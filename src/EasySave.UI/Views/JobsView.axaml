<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:EasySave.UI.ViewModels"
             xmlns:services="using:EasySave.Core.Services"
             x:Class="EasySave.UI.Views.JobsView"
             x:DataType="vm:JobsViewModel">
    
    <Grid Margin="30" RowDefinitions="Auto, *">
        <TextBlock Text="{Binding [Menu_Option1], Source={x:Static services:SettingsManager.Instance}}" FontSize="28" FontWeight="Light" Margin="0,0,0,25"/>

        <Border Grid.Row="1" Background="#252525" CornerRadius="12" Padding="20">
            <Grid RowDefinitions="Auto, *">
                <Grid ColumnDefinitions="*, Auto" Margin="0,0,0,25">
                    <TextBlock Text="{Binding Jobs.Count, StringFormat='{}{0} travaux configurés'}" Foreground="#888" VerticalAlignment="Center" FontSize="14"/>
                    <Button Grid.Column="1" Background="#00bcd4" Foreground="Black" Command="{Binding ExecuteAllCommand}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="▶"/>
                            <TextBlock Text="{Binding [Get_Job_All_Try], Source={x:Static services:SettingsManager.Instance}}"/>
                        </StackPanel>
                    </Button>
                </Grid>

                <Grid Grid.Row="1" RowDefinitions="Auto, *, Auto">
                    <Grid ColumnDefinitions="40, 2*, 2*, 80, 220" Margin="10,0,10,10">
                        <TextBlock Text="{Binding [Header_Id], Source={x:Static services:SettingsManager.Instance}}" FontWeight="Bold" Foreground="#666"/>
                        <TextBlock Grid.Column="1" Text="{Binding [Header_Name], Source={x:Static services:SettingsManager.Instance}}" FontWeight="Bold" Foreground="#666"/>
                        <TextBlock Grid.Column="2" Text="{Binding [Header_Dest], Source={x:Static services:SettingsManager.Instance}}" FontWeight="Bold" Foreground="#666"/>
                        <TextBlock Grid.Column="3" Text="{Binding [Header_Type], Source={x:Static services:SettingsManager.Instance}}" FontWeight="Bold" Foreground="#666"/>
                        <TextBlock Grid.Column="4" Text="ACTIONS" FontWeight="Bold" Foreground="#666" HorizontalAlignment="Center"/>
                    </Grid>

                    <ScrollViewer Grid.Row="1">
                        <ItemsControl ItemsSource="{Binding Jobs}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:JobItemViewModel">
                                    <Border Background="#2d2d2d" CornerRadius="6" Padding="15,10" Margin="0,0,0,8">
                                        <Grid RowDefinitions="Auto, Auto">
                                            <Grid ColumnDefinitions="40, 2*, 2*, 80, 220">
                                                <TextBlock Text="{Binding Id}" VerticalAlignment="Center" Foreground="#666"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Name}" VerticalAlignment="Center" FontWeight="Bold"/>
                                                <TextBlock Grid.Column="2" Text="{Binding TargetDirectory}" VerticalAlignment="Center" Foreground="#aaa"/>
                                                
                                                <Grid Grid.Column="3" VerticalAlignment="Center">
                                                    <Border Background="#228B22" CornerRadius="4" HorizontalAlignment="Left" Padding="8,4" IsVisible="{Binding SaveType}">
                                                        <TextBlock Text="FULL" FontSize="11" FontWeight="Bold" Foreground="White"/>
                                                    </Border>
                                                    <Border Background="#4682B4" CornerRadius="4" HorizontalAlignment="Left" Padding="8,4" IsVisible="{Binding !SaveType}">
                                                        <TextBlock Text="DIFF" FontSize="11" FontWeight="Bold" Foreground="White"/>
                                                    </Border>
                                                </Grid>

                                                <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="4" HorizontalAlignment="Right">
                                                    <Button Content="▶" ToolTip.Tip="Démarrer" Padding="8,4" Background="#2E8B57" Foreground="White" Command="{Binding $parent[UserControl].DataContext.ExecuteJobCommand}" CommandParameter="{Binding Id}"/>
                                                    <Button Content="⏸" ToolTip.Tip="Mettre en pause" Padding="8,4" Background="#DAA520" Foreground="White" Command="{Binding $parent[UserControl].DataContext.PauseJobCommand}" CommandParameter="{Binding Id}"/>
                                                    <Button Content="⏵" ToolTip.Tip="Reprendre" Padding="8,4" Background="#4682B4" Foreground="White" Command="{Binding $parent[UserControl].DataContext.ResumeJobCommand}" CommandParameter="{Binding Id}"/>
                                                    <Button Content="⏹" ToolTip.Tip="Arrêter" Padding="8,4" Background="#8B0000" Foreground="White" Command="{Binding $parent[UserControl].DataContext.StopJobCommand}" CommandParameter="{Binding Id}"/>
                                                    <Button Content="🗑" ToolTip.Tip="Supprimer" Padding="8,4" Background="#555555" Foreground="White" Command="{Binding $parent[UserControl].DataContext.DeleteJobCommand}" CommandParameter="{Binding Id}"/>
                                                </StackPanel>
                                            </Grid>
                                            
                                            <ProgressBar Grid.Row="1" Value="{Binding Progress}" Maximum="100" Height="4" Margin="0,10,0,0" Foreground="#00bcd4" Background="#444" CornerRadius="2"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <TextBlock Grid.Row="2" Text="{Binding StatusMessage}" Foreground="#00bcd4" Margin="10,10,10,0" TextWrapping="Wrap" FontSize="13"/>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>